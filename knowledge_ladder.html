<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Ladder | Ù…Ù†ØµØ© Ø§Ù„Ø³Ù„Ù… Ø§Ù„Ù…Ø¹Ø±ÙÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #3b82f6;
            --accent: #8b5cf6;
            --success: #10b981;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --tier-1-gold: #fbbf24;
            --tier-2-silver: #38bdf8;
            --tier-3-bronze: #9ca3af;
        }

        * { box-sizing: border-box; outline: none; }
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 50px;
        }

        /* --- Animations --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }
        @keyframes successPop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* --- Header --- */
        header {
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(12px);
            padding: 1rem 2rem; position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.1); display: flex;
            justify-content: space-between; align-items: center;
        }
        .logo { font-size: 1.6rem; font-weight: 900; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .logo span { color: #fff; }
        .btn-upload {
            background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border: none;
            padding: 0.7rem 1.8rem; border-radius: 50px; cursor: pointer; font-weight: bold;
            display: flex; align-items: center; gap: 10px; transition: 0.3s;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .btn-upload:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5); }

        /* --- Tiers --- */
        .tier-section { padding: 2.5rem; margin: 2rem auto; max-width: 1200px; border-radius: 20px; min-height: 150px; }
        .tier-header { display: flex; align-items: center; gap: 15px; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .tier-title { font-size: 1.8rem; font-weight: 900; margin: 0; }
        
        .tier-1 { background: linear-gradient(180deg, rgba(251, 191, 36, 0.05) 0%, transparent 100%); border: 1px solid rgba(251, 191, 36, 0.2); }
        .tier-1 .tier-title { color: var(--tier-1-gold); }
        .tier-2 { border-left: 5px solid var(--tier-2-silver); background: rgba(30, 41, 59, 0.3); }
        .tier-2 .tier-title { color: var(--tier-2-silver); }
        .tier-3 { border-left: 5px solid var(--tier-3-bronze); background: rgba(15, 23, 42, 0.6); }
        .tier-3 .tier-title { color: var(--tier-3-bronze); }

        /* --- Cards --- */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 1.5rem; }
        .card {
            background: var(--bg-card); border-radius: 16px; overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255,255,255,0.05); display: flex; flex-direction: column;
            animation: fadeIn 0.6s ease-out;
        }
        .card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .card-media {
            height: 160px; background: #020617; display: flex; align-items: center; justify-content: center;
            color: var(--text-muted); font-size: 3.5rem; position: relative;
            background-image: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
        }
        .type-badge {
            position: absolute; top: 12px; right: 12px;
            background: rgba(59, 130, 246, 0.9); color: #fff;
            padding: 5px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 800; letter-spacing: 0.5px;
        }
        .card-body { padding: 1.5rem; flex-grow: 1; }
        .card-title { margin: 0 0 0.8rem 0; font-size: 1.25rem; line-height: 1.4; }
        .card-desc { font-size: 0.9rem; color: var(--text-muted); line-height: 1.6; }
        .card-actions {
            padding: 1rem 1.5rem; background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        .btn-action { background: none; border: none; color: var(--text-muted); cursor: pointer; transition: 0.2s; display: flex; gap: 6px; align-items: center; font-size: 0.9rem; }
        .btn-action:hover { color: white; }
        .btn-view { color: var(--primary); font-weight: bold; background: rgba(59, 130, 246, 0.1); padding: 6px 12px; border-radius: 6px; }
        .btn-view:hover { background: var(--primary); color: white; }

        /* --- READER MODAL --- */
        .reader-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 3000;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(8px); opacity: 0; transition: opacity 0.3s;
        }
        .reader-overlay.active { opacity: 1; }
        .reader-content {
            background: #0f172a; width: 900px; max-width: 95%; height: 90%;
            border-radius: 20px; overflow: hidden; display: flex; flex-direction: column;
            border: 1px solid #334155; box-shadow: 0 25px 60px rgba(0,0,0,0.7);
            transform: scale(0.95); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .reader-overlay.active .reader-content { transform: scale(1); }
        .reader-header {
            padding: 1.5rem 2rem; background: #1e293b; border-bottom: 1px solid #334155;
            display: flex; justify-content: space-between; align-items: center;
        }
        .reader-title-area h3 { margin: 0; font-size: 1.4rem; color: var(--primary); }
        .reader-meta { font-size: 0.85rem; color: var(--text-muted); margin-top: 5px; }
        .reader-body { padding: 3rem; overflow-y: auto; flex-grow: 1; color: #e2e8f0; line-height: 1.9; font-size: 1.1rem; scroll-behavior: smooth; }
        .btn-close-reader {
            background: rgba(255,255,255,0.1); color: white; border: none; width: 36px; height: 36px;
            border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .btn-close-reader:hover { background: #dc2626; transform: rotate(90deg); }

        /* Course HTML Styles */
        .course-html { animation: slideUp 0.6s ease-out; max-width: 800px; margin: 0 auto; }
        .course-html h1 { font-size: 2.2rem; margin-bottom: 2rem; background: linear-gradient(90deg, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .course-html h2 { color: var(--tier-2-silver); margin-top: 3rem; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .highlight-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 2rem; margin: 2rem 0; position: relative; overflow: hidden;
        }
        .highlight-box::before { content: ''; position: absolute; top: 0; right: 0; width: 4px; height: 100%; background: var(--primary); }
        .step-list { list-style: none; padding: 0; margin: 2rem 0; display: grid; gap: 15px; }
        .step-item { background: #1e293b; padding: 1.5rem; border-radius: 10px; border: 1px solid #334155; display: flex; gap: 15px; align-items: flex-start; transition: 0.3s; }
        .step-item:hover { border-color: var(--primary); transform: translateX(-5px); }
        .step-num { background: var(--primary); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
        .grid-visual { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 2rem 0; }
        .grid-box { padding: 2rem; border-radius: 12px; color: white; text-align: center; display: flex; flex-direction: column; justify-content: center; min-height: 150px; }

        /* SUCCESS BUTTON STYLE */
        .btn-complete {
            display: flex; justify-content: center; align-items: center; gap: 10px;
            width: 100%; max-width: 300px; margin: 4rem auto 0;
            padding: 1rem; background: var(--primary); color: white; border: none; border-radius: 12px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; text-align: center;
            transition: all 0.3s ease; animation: pulse 2s infinite;
        }
        .btn-complete:hover { background: #2563eb; animation: none; transform: translateY(-2px); }
        .btn-complete.success {
            background-color: var(--success); animation: successPop 0.3s ease-out; cursor: default;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fa-solid fa-layer-group fa-lg"></i>
            <div>Knowledge <span>Ladder</span></div>
        </div>
        <button class="btn-upload" onclick="alert('Demo Mode')"><i class="fa-solid fa-cloud-arrow-up"></i> Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø¹Ø±ÙØ©</button>
    </header>

    <main>
        <section class="tier-section tier-1">
            <div class="tier-header">
                <i class="fa-solid fa-crown fa-2x" style="color: var(--tier-1-gold)"></i>
                <div><h2 class="tier-title">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø°Ù‡Ø¨ÙŠ (Tier 1)</h2><div style="font-size:0.9rem; color:#64748b">The Gold Standard</div></div>
            </div>
            <div class="grid-container" id="tier1-container"></div>
        </section>

        <section class="tier-section tier-2">
            <div class="tier-header">
                <i class="fa-solid fa-flask fa-2x" style="color: var(--tier-2-silver)"></i>
                <div><h2 class="tier-title">Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± (Tier 2)</h2><div style="font-size:0.9rem; color:#64748b">Active Development</div></div>
            </div>
            <div class="grid-container" id="tier2-container"></div>
        </section>

        <section class="tier-section tier-3">
            <div class="tier-header">
                <i class="fa-solid fa-seedling fa-2x" style="color: var(--tier-3-bronze)"></i>
                <div><h2 class="tier-title">Ø§Ù„Ù…Ø®ØªØ¨Ø± (Tier 3)</h2><p style="color:#94a3b8; margin: 5px 0 0 0">Ø£ÙÙƒØ§Ø± Ø¬Ø¯ÙŠØ¯Ø© ØªÙ†ØªØ¸Ø± Ø§Ù„ØªØ·ÙˆÙŠØ±.. Ø§Ø¶ØºØ· <strong>Ù…Ø¹Ø§ÙŠÙ†Ø©</strong> Ù„Ù„ØªØ¬Ø±Ø¨Ø©.</p></div>
            </div>
            <div class="grid-container" id="tier3-container"></div>
        </section>
    </main>

    <div class="reader-overlay" id="readerModal">
        <div class="reader-content">
            <div class="reader-header">
                <div class="reader-title-area">
                    <h3 id="readerTitle">...</h3>
                    <div class="reader-meta" id="readerAuthor">...</div>
                </div>
                <button class="btn-close-reader" onclick="closeReader()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="reader-body" id="readerBody"></div>
        </div>
    </div>

    <script>
        // *** CRITICAL UPDATE: Changed key to 'v2' to force fresh data load ***
        const STORAGE_KEY = 'knowledge_ladder_db_v2';

        function generateCourses() {
            return [
                { 
                    id: 1, 
                    title: "ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ (Pomodoro)", 
                    type: "course", tier: 3, author: "TechLead", date: "2026-02-01",
                    desc: "ØªØ¹Ù„Ù… ÙƒÙŠÙ ØªØ¨Ø±Ù…Ø¬ Ù„Ù…Ø¯Ø© 25 Ø¯Ù‚ÙŠÙ‚Ø© Ø¨ØªØ±ÙƒÙŠØ² ØªØ§Ù….",
                    htmlContent: `
                        <div class="course-html">
                            <div style="text-align:center; margin-bottom:3rem">
                                <i class="fa-regular fa-clock fa-4x" style="color:#ef4444; margin-bottom:1rem"></i>
                                <h1>ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ</h1>
                                <p style="font-size:1.2rem; color:#94a3b8">ÙƒÙŠÙ ØªÙ†Ø¬Ø² Ø¶Ø¹Ù Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ù†ØµÙ Ø§Ù„ÙˆÙ‚ØªØŸ</p>
                            </div>
                            <div class="highlight-box">
                                <h3 style="margin-top:0"><i class="fa-solid fa-lightbulb"></i> Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
                                <p>Ø¹Ù‚Ù„Ùƒ Ù„ÙŠØ³ Ù…ØµÙ…Ù…Ø§Ù‹ Ù„Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ù…Ø³ØªÙ…Ø±. Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©: 25 Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù…Ù„ + 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø±Ø§Ø­Ø©.</p>
                            </div>
                            <h2><i class="fa-solid fa-list-check"></i> Ø§Ù„Ø®Ø·ÙˆØ§Øª</h2>
                            <ul class="step-list">
                                <li class="step-item"><span class="step-num">1</span><div><strong>Ø­Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ù…Ø©:</strong> Ø§Ø®ØªØ± Ø´ÙŠØ¦Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ ÙÙ‚Ø·.</div></li>
                                <li class="step-item"><span class="step-num">2</span><div><strong>Ø§Ø¶Ø¨Ø· Ø§Ù„Ù…Ø¤Ù‚Øª:</strong> 25 Ø¯Ù‚ÙŠÙ‚Ø©. Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„ØªÙˆÙ‚Ù.</div></li>
                                <li class="step-item"><span class="step-num">3</span><div><strong>Ø§Ø³ØªØ±Ø§Ø­Ø©:</strong> 5 Ø¯Ù‚Ø§Ø¦Ù‚. Ø§Ø¨ØªØ¹Ø¯ Ø¹Ù† Ø§Ù„Ø´Ø§Ø´Ø©.</div></li>
                            </ul>
                            <button class="btn-complete" onclick="closeReaderWithSuccess(this)"><span>ğŸ‰ Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ø¯Ø±Ø³</span></button>
                        </div>`
                },
                { 
                    id: 2, 
                    title: "Ù…ØµÙÙˆÙØ© Ø£ÙŠØ²Ù†Ù‡Ø§ÙˆØ± (Eisenhower)", 
                    type: "course", tier: 3, author: "PM_Sarah", date: "2026-02-02",
                    desc: "Ø£Ø¯Ø§Ø© Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø± Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª.",
                    htmlContent: `
                        <div class="course-html">
                            <h1>ğŸ“Š Ù…ØµÙÙˆÙØ© Ø£ÙŠØ²Ù†Ù‡Ø§ÙˆØ±</h1>
                            <div class="grid-visual">
                                <div class="grid-box" style="background: linear-gradient(135deg, #ef4444, #b91c1c);"><h3>1. Ø§ÙØ¹Ù„Ù‡ Ø§Ù„Ø¢Ù†</h3><p>Ù‡Ø§Ù… ÙˆØ¹Ø§Ø¬Ù„</p></div>
                                <div class="grid-box" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"><h3>2. Ø®Ø·Ø· Ù„Ù‡</h3><p>Ù‡Ø§Ù… ÙˆØºÙŠØ± Ø¹Ø§Ø¬Ù„</p></div>
                                <div class="grid-box" style="background: linear-gradient(135deg, #eab308, #a16207);"><h3>3. ÙÙˆØ¶Ù‡</h3><p>ØºÙŠØ± Ù‡Ø§Ù… ÙˆØ¹Ø§Ø¬Ù„</p></div>
                                <div class="grid-box" style="background: linear-gradient(135deg, #64748b, #334155);"><h3>4. Ø§ØªØ±ÙƒÙ‡</h3><p>ØºÙŠØ± Ù‡Ø§Ù… ÙˆØºÙŠØ± Ø¹Ø§Ø¬Ù„</p></div>
                            </div>
                            <button class="btn-complete" onclick="closeReaderWithSuccess(this)"><span>ğŸ‰ Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ø¯Ø±Ø³</span></button>
                        </div>`
                },
                { 
                    id: 3, 
                    title: "Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù€ 5 Ø«ÙˆØ§Ù†ÙŠ", 
                    type: "course", tier: 3, author: "HR_Team", date: "2026-02-03",
                    desc: "ÙƒÙŠÙ ØªØ®Ø¯Ø¹ Ø¹Ù‚Ù„Ùƒ Ù„ÙŠØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„ØªØ³ÙˆÙŠÙ.",
                    htmlContent: `
                        <div class="course-html">
                            <div style="text-align:center;"><h1 style="font-size:4rem; margin:0; color:var(--primary)">5 - 4 - 3 - 2 - 1 ğŸš€</h1><h2>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù€ 5 Ø«ÙˆØ§Ù†ÙŠ</h2></div>
                            <div class="highlight-box" style="border-right:none; border-left:4px solid var(--accent);"><h3>ğŸ§  Ù„Ù…Ø§Ø°Ø§ ØªØ¹Ù…Ù„ØŸ</h3><p>Ø§Ù„Ø¹Ø¯ Ø§Ù„Ø¹ÙƒØ³ÙŠ ÙŠÙ‚Ø·Ø¹ Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…Ø¹ØªØ§Ø¯Ø© ÙˆÙŠÙ†Ø´Ø· Ø§Ù„Ù‚Ø´Ø±Ø© Ø§Ù„Ø¬Ø¨Ù‡ÙŠØ©.</p></div>
                            <button class="btn-complete" onclick="closeReaderWithSuccess(this)"><span>ğŸ‰ Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ø¯Ø±Ø³</span></button>
                        </div>`
                }
            ];
        }

        // --- Logic ---
        let allContent = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

        // Force load if empty
        if (allContent.length === 0) {
            allContent = generateCourses();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allContent));
        }

        function renderAll() {
            const tiers = { 1: [], 2: [], 3: [] };
            allContent.forEach(item => tiers[item.tier].push(item));

            ['tier1', 'tier2', 'tier3'].forEach((id, idx) => {
                const container = document.getElementById(`${id}-container`);
                const items = tiers[idx + 1];
                if (items.length === 0) container.innerHTML = `<div class="empty-state">Ø§Ù„Ù…Ø³Ø§Ø± ÙØ§Ø±Øº Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
                else {
                    container.innerHTML = items.map(item => `
                        <article class="card">
                            <div class="card-media"><span class="type-badge">COURSE</span><i class="fa-solid fa-laptop-code"></i></div>
                            <div class="card-body"><h3 class="card-title">${item.title}</h3><p class="card-desc">${item.desc}</p></div>
                            <div class="card-actions">
                                <div style="font-size:0.8rem; color:#64748b"><i class="fa-solid fa-user"></i> ${item.author}</div>
                                <button class="btn-action btn-view" onclick="openReader(${item.id})">Ù…Ø¹Ø§ÙŠÙ†Ø© <i class="fa-solid fa-arrow-left"></i></button>
                            </div>
                        </article>`).join('');
                }
            });
        }

        // --- Reader Functions ---
        const readerModal = document.getElementById('readerModal');
        const readerTitle = document.getElementById('readerTitle');
        const readerAuthor = document.getElementById('readerAuthor');
        const readerBody = document.getElementById('readerBody');

        function openReader(id) {
            const item = allContent.find(c => c.id === id);
            if(item && item.htmlContent) {
                readerTitle.innerText = item.title;
                readerAuthor.innerText = "Ø§Ù„Ù…Ø¤Ù„Ù: " + item.author;
                readerBody.innerHTML = item.htmlContent;
                readerModal.style.display = 'flex';
                setTimeout(() => readerModal.classList.add('active'), 10);
            }
        }

        function closeReader() {
            readerModal.classList.remove('active');
            setTimeout(() => readerModal.style.display = 'none', 300);
        }

        // *** ROBUST FUNCTION with fallback ***
        function closeReaderWithSuccess(btnElement) {
            // Safety Check: If button element is missing or undefined
            if (!btnElement) {
                closeReader(); 
                return;
            }

            btnElement.innerHTML = '<span>ØªÙ… Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…</span>';
            btnElement.classList.add('success');
            setTimeout(() => closeReader(), 1000);
        }

        renderAll();
        readerModal.onclick = (e) => { if(e.target === readerModal) closeReader(); }
    </script>
</body>
</html>